risetime_start_offset_avg_diary_ears =
as.numeric(
ifelse(
(
!is.na(risetime_start_offset_minutes_ears) &
!is.na(risetime_start_offset_minutes_diary)
),
(
risetime_start_offset_minutes_ears + risetime_start_offset_minutes_diary
) / 2,
NA
)),
# Diary and Actilife Risetime Average
risetime_start_offset_avg_diary_actilife =
as.numeric(
ifelse(
(
!is.na(risetime_start_offset_minutes_actilife) &
!is.na(risetime_start_offset_minutes_diary)
),
(
risetime_start_offset_minutes_actilife + risetime_start_offset_minutes_diary
) / 2,
NA
)),
# EARS and Actilife Risetime Average
risetime_start_offset_avg_actilife_ears =
as.numeric(
ifelse(
(
!is.na(risetime_start_offset_minutes_actilife) &
!is.na(risetime_start_offset_minutes_ears)
),
(
risetime_start_offset_minutes_actilife + risetime_start_offset_minutes_ears
) / 2,
NA
)),
### Supplementary Diary Sleep Offset and EARS Risetime Average
sleep_and_risetime_start_offset_avg_diary_ears =
as.numeric(
ifelse(
(
!is.na(risetime_start_offset_minutes_ears) &
!is.na(sleep_period_start_offset_minutes_diary)
),
(
risetime_start_offset_minutes_ears + sleep_period_start_offset_minutes_diary
) / 2,
NA
)),
### Supplementary Diary Sleep Offset and Actilife Risetime Average
sleep_and_risetime_start_offset_avg_diary_actilife =
as.numeric(
ifelse(
(
!is.na(risetime_start_offset_minutes_actilife) &
!is.na(sleep_period_start_offset_minutes_diary)
),
(
risetime_start_offset_minutes_actilife + sleep_period_start_offset_minutes_diary
) / 2,
NA
)),
# Diary and EARS Time in Bed Average
time_in_bed_minutes_avg_diary_ears =
as.numeric(
ifelse(
(
!is.na(time_in_bed_minutes_ears) &
!is.na(time_in_bed_minutes_diary)
),
(
time_in_bed_minutes_ears + time_in_bed_minutes_diary
) / 2,
NA
)),
# Diary and Actilife Time in Bed Average
time_in_bed_minutes_avg_diary_actilife =
as.numeric(
ifelse(
(
!is.na(time_in_bed_minutes_actilife) &
!is.na(time_in_bed_minutes_diary)
),
(
time_in_bed_minutes_actilife + time_in_bed_minutes_diary
) / 2,
NA
)),
# EARS and Actilife Time in Bed Average
time_in_bed_minutes_avg_actilife_ears =
as.numeric(
ifelse(
(
!is.na(time_in_bed_minutes_actilife) &
!is.na(time_in_bed_minutes_ears)
),
(
time_in_bed_minutes_actilife + time_in_bed_minutes_ears
) / 2,
NA
)),
### Supplementary Diary Sleep Duration and EARS Time in Bed Average
duration_and_time_in_bed_minutes_avg_diary_ears =
as.numeric(
ifelse(
(
!is.na(time_in_bed_minutes_ears) &
!is.na(sleep_duration_minutes_diary)
),
(
time_in_bed_minutes_ears + sleep_duration_minutes_diary
) / 2,
NA
)),
### Supplementary Diary Sleep Duration and Actilife Time in Bed Average
duration_and_time_in_bed_minutes_avg_diary_actilife =
as.numeric(
ifelse(
(
!is.na(time_in_bed_minutes_actilife) &
!is.na(sleep_duration_minutes_diary)
),
(
time_in_bed_minutes_actilife + sleep_duration_minutes_diary
) / 2,
NA
)),
# Difference between Diary and EARS Bedtime
bedtime_diff_min_diary_ears =
as.numeric(
difftime(
bedtime_timestamp_diary,
bedtime_timestamp_ears,
units = "mins"
)
),
# Difference between Diary and Actilife Bedtime
bedtime_diff_min_diary_actilife =
as.numeric(
difftime(
bedtime_timestamp_diary,
bedtime_timestamp_actilife,
units = "mins"
)
),
# Difference between Actilife and EARS Bedtime
bedtime_diff_min_actilife_ears =
as.numeric(
difftime(
bedtime_timestamp_actilife,
bedtime_timestamp_ears,
units = "mins"
)
),
### Supplementary Difference between Diary Sleep Onset and EARS Bedtime
sleep_onset_bedtime_diff_min_diary_ears =
as.numeric(
difftime(
sleep_onset_timestamp_diary,
bedtime_timestamp_ears,
units = "mins"
)
),
### Supplementary Difference between Diary Sleep Onset and Actilife Bedtime
sleep_onset_bedtime_diff_min_diary_actilife =
as.numeric(
difftime(
sleep_onset_timestamp_diary,
bedtime_timestamp_actilife,
units = "mins"
)
),
# Difference between Diary and EARS Risetime
risetime_diff_min_diary_ears =
as.numeric(
difftime(
risetime_timestamp_diary,
risetime_timestamp_ears,
units = "mins"
)
),
# Difference between Diary and Actilife Risetime
risetime_diff_min_diary_actilife =
as.numeric(
difftime(
risetime_timestamp_diary,
risetime_timestamp_actilife,
units = "mins"
)
),
# Difference between Actilife and EARS Risetime
risetime_diff_min_actilife_ears =
as.numeric(
difftime(
risetime_timestamp_actilife,
risetime_timestamp_ears,
units = "mins"
)
),
### Supplementary Difference between Diary Sleep Offset and EARS Risetime
sleep_offset_risetime_diff_min_diary_ears =
as.numeric(
difftime(
sleep_offset_timestamp_diary,
risetime_timestamp_ears,
units = "mins"
)
),
### Supplementary Difference between Diary Sleep Offset and Actilife Risetime
sleep_offset_risetime_diff_min_diary_actilife =
as.numeric(
difftime(
sleep_offset_timestamp_diary,
risetime_timestamp_actilife,
units = "mins"
)
),
# Difference between Diary and EARS Time in Bed
time_in_bed_minutes_diff_min_diary_ears =
time_in_bed_minutes_diary - time_in_bed_minutes_ears,
# Difference between Diary and Actilife Time in Bed
time_in_bed_minutes_diff_min_diary_actilife =
time_in_bed_minutes_diary - time_in_bed_minutes_actilife,
# Difference between Actilife and EARS Time in Bed
time_in_bed_minutes_diff_min_actilife_ears =
time_in_bed_minutes_actilife - time_in_bed_minutes_ears,
### Supplementary Difference between Diary Sleep Duration and EARS Time in Bed
sleep_dur_time_in_bed_minutes_diff_min_diary_ears =
sleep_duration_minutes_diary - time_in_bed_minutes_ears,
### Supplementary Difference between Diary Sleep Duration and Actilife Time in Bed
sleep_dur_time_in_bed_minutes_diff_min_diary_actilife =
sleep_duration_minutes_diary - time_in_bed_minutes_actilife,
)
df_analysis_wide_sample1 <-
df_analysis_wide2 %>%
filter(!is.na(bedtime_start_onset_minutes_diary) &
!is.na(risetime_start_offset_minutes_diary) &
!is.na(bedtime_start_onset_minutes_ears) &
!is.na(risetime_start_offset_minutes_ears))
unique_actilife_id_trunc <- unique(df_analysis_wide2$actilife_id)
df_sp_trunc <- data.frame(minutes = seq(1, 849, by = 1))
df_acc_ears_trunc <- data.frame(
actilife_id <- as.character(),
day_num <- as.character(),
true_bed_EARS_DIARY_t <- as.character(),
false_bed_EARS_DIARY_t <- as.character(),
true_rise_EARS_DIARY_t <- as.character(),
false_rise_EARS_DIARY_t <- as.character(),
sensitivity_EARS_DIARY_t <- as.character(),
specificity_EARS_DIARY_t <- as.character(),
accuracy_EARS_DIARY_t <- as.character()
)
df_acc_ears_trunc_long <- data.frame(
actilife_id <- as.character(),
day_num <- as.character(),
minutes <- as.character(),
diary_bed <- as.character(),
ears_bed <- as.character(),
true_bed_EARS_DIARY_t <- as.character(),
false_bed_EARS_DIARY_t <- as.character(),
true_rise_EARS_DIARY_t <- as.character(),
false_rise_EARS_DIARY_t <- as.character()
)
for(i in seq_along(unique_actilife_id_trunc)){
df_temp_i_trunc <- df_analysis_wide2 %>%
filter(
actilife_id == unique_actilife_id_trunc[i] &
!is.na(bedtime_start_onset_minutes_diary) &
!is.na(risetime_start_offset_minutes_diary) &
!is.na(bedtime_start_onset_minutes_ears) &
!is.na(risetime_start_offset_minutes_ears))
unique_day_num_trunc <- unique(df_temp_i_trunc$day_num)
df_epoch_by_epoch_trunc <- data.frame(
day_num <- as.character(),
true_bed_EARS_DIARY_t <- as.character(),
false_bed_EARS_DIARY_t <- as.character(),
true_rise_EARS_DIARY_t <- as.character(),
false_rise_EARS_DIARY_t <- as.character(),
sensitivity_EARS_DIARY_t <- as.character(),
specificity_EARS_DIARY_t <- as.character(),
accuracy_EARS_DIARY_t <- as.character()
)
df_epoch_by_epoch_trunc_long <- data.frame(
minutes <- as.character(),
diary_bed <- as.character(),
ears_bed <- as.character(),
day_num <- as.character(),
true_bed_EARS_DIARY_t <- as.character(),
false_bed_EARS_DIARY_t <- as.character(),
true_rise_EARS_DIARY_t <- as.character(),
true_rise_EARS_DIARY_t <- as.character()
)
for(j in seq_along(unique_day_num_trunc)){
#  if(!is.na(df_temp$sleep_period_start_onset_minutes_diary[j]) & !is.na(df_temp$sleep_period_start_onset_minutes_ears[j])){
df_diary_bed_trunc <-
data.frame(
minutes = seq(
df_temp_i_trunc$bedtime_start_onset_minutes_diary[j],
df_temp_i_trunc$risetime_start_offset_minutes_diary[j],
by = 1
),
diary_bed = 1
)
df_ears_bed_trunc <-
data.frame(
minutes = seq(
round(df_temp_i_trunc$bedtime_start_onset_minutes_ears[j],0),
round(df_temp_i_trunc$risetime_start_offset_minutes_ears[j],0),
by = 1
),
ears_bed = 1
)
df_temp_j_trunc <-
left_join(df_sp_trunc, df_diary_bed_trunc, by = c("minutes")) %>%
left_join(df_ears_bed_trunc, by = c("minutes")) %>% mutate(day_num = j)
df_temp_j_trunc <-
df_temp_j_trunc %>%
dplyr::mutate(
true_bed_EARS_DIARY_t =
as.numeric(ifelse((diary_bed == 1 & ears_bed == 1 & !is.na(diary_bed) & !is.na(ears_bed)), 1, 0)),
false_bed_EARS_DIARY_t =
as.numeric(ifelse((is.na(diary_bed) & ears_bed == 1 & !is.na(ears_bed)), 1, 0)),
true_rise_EARS_DIARY_t =
as.numeric(ifelse((is.na(diary_bed) & is.na(ears_bed)), 1, 0)),
false_rise_EARS_DIARY_t =
as.numeric(ifelse((diary_bed == 1 & is.na(ears_bed) & !is.na(diary_bed)), 1, 0))
)
df_temp_j_agg_trunc <-
df_temp_j_trunc %>%
dplyr::group_by(day_num) %>%
dplyr::summarise(
true_bed_EARS_DIARY_t = sum(true_bed_EARS_DIARY_t, na.rm = TRUE),
false_bed_EARS_DIARY_t = sum(false_bed_EARS_DIARY_t, na.rm = TRUE),
true_rise_EARS_DIARY_t = sum(true_rise_EARS_DIARY_t, na.rm = TRUE),
false_rise_EARS_DIARY_t = sum(false_rise_EARS_DIARY_t, na.rm = TRUE)
) %>%
dplyr::ungroup() %>%
dplyr::mutate(
ears.diary_bed_sensitivity_trunc =
true_bed_EARS_DIARY_t/(true_bed_EARS_DIARY_t + false_bed_EARS_DIARY_t),
ears.diary_bed_specificity_trunc =
true_rise_EARS_DIARY_t/(false_rise_EARS_DIARY_t + true_rise_EARS_DIARY_t),
ears.diary_bed_accuracy_trunc =
(true_bed_EARS_DIARY_t + true_rise_EARS_DIARY_t) / (true_bed_EARS_DIARY_t + false_bed_EARS_DIARY_t + true_rise_EARS_DIARY_t + false_rise_EARS_DIARY_t)
)
df_epoch_by_epoch_trunc <- rbind(df_epoch_by_epoch_trunc, df_temp_j_agg_trunc)
df_epoch_by_epoch_trunc_long <- rbind(df_epoch_by_epoch_trunc_long, df_temp_j_trunc)
}
df_epoch_by_epoch_trunc <-
df_epoch_by_epoch_trunc %>%
dplyr::mutate(actilife_id = unique_actilife_id_trunc[i])
df_epoch_by_epoch_trunc_long <-
df_epoch_by_epoch_trunc_long %>%
dplyr::mutate(actilife_id = unique_actilife_id_trunc[i])
df_acc_ears_trunc <- rbind(df_acc_ears_trunc, df_epoch_by_epoch_trunc)
df_acc_ears_trunc_long <- rbind(df_acc_ears_trunc_long, df_epoch_by_epoch_trunc_long)
#  rm(df_temp_i, df_epoch_by_epoch)
}
rm(df_sp_trunc)
# match into analysis dataset
df_analysis_wide2 <- df_analysis_wide2 %>% left_join(df_acc_ears_trunc, by = c("actilife_id", "day_num"))
View(df_acc_ears_trunc_long)
library(pROC)
bedtime_roc <-
roc(df_acc_ears_trunc_long$true_bed_EARS_DIARY_t, df_acc_ears_trunc_long$false_bed_EARS_DIARY_t)
bedtime_roc
rocobj <- plot.roc(
df_acc_ears_trunc_long$true_bed_EARS_DIARY_t, df_acc_ears_trunc_long$false_bed_EARS_DIARY_t,
main = "Confidence intervals",
percent=TRUE,
ci = TRUE,   # compute AUC (of AUC by default)
print.auc = TRUE # print the AUC (will contain the CI)
)
View(df_acc_ears_trunc)
unique_actilife_id_trunc <- unique(df_analysis_wide2$actilife_id)
df_sp_trunc <- data.frame(minutes = seq(1, 849, by = 1))
df_acc_ears_trunc <- data.frame(
actilife_id <- as.character(),
day_num <- as.character(),
true_bed_EARS_DIARY_t <- as.character(),
false_bed_EARS_DIARY_t <- as.character(),
true_rise_EARS_DIARY_t <- as.character(),
false_rise_EARS_DIARY_t <- as.character(),
sensitivity_EARS_DIARY_t <- as.character(),
specificity_EARS_DIARY_t <- as.character(),
accuracy_EARS_DIARY_t <- as.character()
)
df_acc_ears_trunc_long <- data.frame(
actilife_id <- as.character(),
day_num <- as.character(),
minutes <- as.character(),
diary_bed <- as.character(),
ears_bed <- as.character(),
true_bed_EARS_DIARY_t <- as.character(),
false_bed_EARS_DIARY_t <- as.character(),
true_rise_EARS_DIARY_t <- as.character(),
false_rise_EARS_DIARY_t <- as.character()
)
for(i in seq_along(unique_actilife_id_trunc)){
df_temp_i_trunc <- df_analysis_wide2 %>%
filter(
actilife_id == unique_actilife_id_trunc[i] &
!is.na(bedtime_start_onset_minutes_diary) &
!is.na(risetime_start_offset_minutes_diary) &
!is.na(bedtime_start_onset_minutes_ears) &
!is.na(risetime_start_offset_minutes_ears))
unique_day_num_trunc <- unique(df_temp_i_trunc$day_num)
df_epoch_by_epoch_trunc <- data.frame(
day_num <- as.character(),
true_bed_EARS_DIARY_t <- as.character(),
false_bed_EARS_DIARY_t <- as.character(),
true_rise_EARS_DIARY_t <- as.character(),
false_rise_EARS_DIARY_t <- as.character(),
sensitivity_EARS_DIARY_t <- as.character(),
specificity_EARS_DIARY_t <- as.character(),
accuracy_EARS_DIARY_t <- as.character()
)
df_epoch_by_epoch_trunc_long <- data.frame(
minutes <- as.character(),
diary_bed <- as.character(),
ears_bed <- as.character(),
day_num <- as.character(),
true_bed_EARS_DIARY_t <- as.character(),
false_bed_EARS_DIARY_t <- as.character(),
true_rise_EARS_DIARY_t <- as.character(),
true_rise_EARS_DIARY_t <- as.character()
)
for(j in seq_along(unique_day_num_trunc)){
#  if(!is.na(df_temp$sleep_period_start_onset_minutes_diary[j]) & !is.na(df_temp$sleep_period_start_onset_minutes_ears[j])){
df_diary_bed_trunc <-
data.frame(
minutes = seq(
df_temp_i_trunc$bedtime_start_onset_minutes_diary[j],
df_temp_i_trunc$risetime_start_offset_minutes_diary[j],
by = 1
),
diary_bed = 1
)
df_ears_bed_trunc <-
data.frame(
minutes = seq(
round(df_temp_i_trunc$bedtime_start_onset_minutes_ears[j],0),
round(df_temp_i_trunc$risetime_start_offset_minutes_ears[j],0),
by = 1
),
ears_bed = 1
)
df_temp_j_trunc <-
left_join(df_sp_trunc, df_diary_bed_trunc, by = c("minutes")) %>%
left_join(df_ears_bed_trunc, by = c("minutes")) %>% mutate(day_num = j)
df_temp_j_trunc <-
df_temp_j_trunc %>%
dplyr::mutate(
true_bed_EARS_DIARY_t =
as.numeric(ifelse((diary_bed == 1 & ears_bed == 1 & !is.na(diary_bed) & !is.na(ears_bed)), 1, 0)),
false_bed_EARS_DIARY_t =
as.numeric(ifelse((is.na(diary_bed) & ears_bed == 1 & !is.na(ears_bed)), 1, 0)),
true_rise_EARS_DIARY_t =
as.numeric(ifelse((is.na(diary_bed) & is.na(ears_bed)), 1, 0)),
false_rise_EARS_DIARY_t =
as.numeric(ifelse((diary_bed == 1 & is.na(ears_bed) & !is.na(diary_bed)), 1, 0))
)
df_temp_j_agg_trunc <-
df_temp_j_trunc %>%
dplyr::group_by(day_num) %>%
dplyr::summarise(
true_bed_EARS_DIARY_t = sum(true_bed_EARS_DIARY_t, na.rm = TRUE),
false_bed_EARS_DIARY_t = sum(false_bed_EARS_DIARY_t, na.rm = TRUE),
true_rise_EARS_DIARY_t = sum(true_rise_EARS_DIARY_t, na.rm = TRUE),
false_rise_EARS_DIARY_t = sum(false_rise_EARS_DIARY_t, na.rm = TRUE)
) %>%
dplyr::ungroup() %>%
dplyr::mutate(
ears.diary_bed_sensitivity_trunc =
true_bed_EARS_DIARY_t/(true_bed_EARS_DIARY_t + false_bed_EARS_DIARY_t),
ears.diary_bed_specificity_trunc =
true_rise_EARS_DIARY_t/(false_rise_EARS_DIARY_t + true_rise_EARS_DIARY_t),
ears.diary_bed_accuracy_trunc =
(true_bed_EARS_DIARY_t + true_rise_EARS_DIARY_t) / (true_bed_EARS_DIARY_t + false_bed_EARS_DIARY_t + true_rise_EARS_DIARY_t + false_rise_EARS_DIARY_t)
)
df_temp_j_truncz <-
df_temp_j_trunc %>%
ungroup() %>%
dplyr::mutate(
ears.diary_bed_sensitivity_trunc =
true_bed_EARS_DIARY_t/(true_bed_EARS_DIARY_t + false_bed_EARS_DIARY_t),
ears.diary_bed_specificity_trunc =
true_rise_EARS_DIARY_t/(false_rise_EARS_DIARY_t + true_rise_EARS_DIARY_t),
ears.diary_bed_accuracy_trunc =
(true_bed_EARS_DIARY_t + true_rise_EARS_DIARY_t) / (true_bed_EARS_DIARY_t + false_bed_EARS_DIARY_t + true_rise_EARS_DIARY_t + false_rise_EARS_DIARY_t)
)
df_epoch_by_epoch_trunc <- rbind(df_epoch_by_epoch_trunc, df_temp_j_agg_trunc)
df_epoch_by_epoch_trunc_long <- rbind(df_epoch_by_epoch_trunc_long, df_temp_j_trunc)
df_epoch_by_epoch_truncz_long <- rbind(df_epoch_by_epoch_trunc_long, df_temp_j_truncz)
}
df_epoch_by_epoch_trunc <-
df_epoch_by_epoch_trunc %>%
dplyr::mutate(actilife_id = unique_actilife_id_trunc[i])
df_epoch_by_epoch_trunc_long <-
df_epoch_by_epoch_trunc_long %>%
dplyr::mutate(actilife_id = unique_actilife_id_trunc[i])
df_epoch_by_epoch_truncz_long <-
df_epoch_by_epoch_truncz_long %>%
dplyr::mutate(actilife_id = unique_actilife_id_trunc[i])
df_acc_ears_trunc <- rbind(df_acc_ears_trunc, df_epoch_by_epoch_trunc)
df_acc_ears_trunc_long <- rbind(df_acc_ears_trunc_long, df_epoch_by_epoch_trunc_long)
df_acc_ears_truncz_long <- rbind(df_acc_ears_truncz_long, df_epoch_by_epoch_truncz_long)
#  rm(df_temp_i, df_epoch_by_epoch)
}
View(df_temp_j_truncz)
